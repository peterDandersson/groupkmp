<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<f:view>
    <style>
        /*table {border-spacing: 0px;}*/
        table {
            border-collapse: separate;
        }

        tr.even-row {
            background-color: #e3e3e3;
        }

        tr.odd-row {
            background-color: #eee;
        }

        tr.selected-row {
            background-color: #ffa;
        }

        .ui-datatable table {
            width: auto;
        }

        .ui-panelgrid td.ui-panelgrid-cell {
            padding: 0px;
        }

        /*tr.even-row td, tr.odd-row td {padding: 10px;}
        tr.even-row:first-child td:first-child, tr.even-row:first-child td:first-child { border-top-left-radius: 10px; margin-top: 15px; }
        tr:first-child td:last-child { border-top-right-radius: 10px; }
        tr:last-child td:first-child { border-bottom-left-radius: 10px; }
        tr:last-child td:last-child { border-bottom-right-radius: 10px; }
        td { border-: 25px 0px; }
        */
    </style>
    <h:form id="courses-table">
        <c:if test="#{context == 'studentRegisteredCourses'}">
            <c:set var="courses" value="#{userBean.courses}" />
            <c:set var="noResultsMessage" value="You are not registered for any courses." />
        </c:if>
        <c:if test="#{context == 'studentOtherCourses'}">
            <c:set var="courses" value="#{userBean.otherCourses}" />
            <c:set var="noResultsMessage" value="There are no other courses to choose from." />
        </c:if>
        <c:if test="#{context == 'adminAllCourses'}">
            <c:set var="courses" value="#{courseBean.allCourses}" />
            <c:set var="noResultsMessage" value="There are no courses." />
        </c:if>
        <c:if test="#{context == 'attendance'}">
            <c:set var="courses" value="#{courseBean.allCourses}" />
            <c:set var="noResultsMessage" value="There are no courses." />
        </c:if>
        <h:panelGroup rendered="#{courses.size() == 0}">
            <h:outputText value="#{noResultsMessage}" />
        </h:panelGroup>

        <p:panelGrid columns="1" rendered="#{courses.size() > 0}">
            <p:dataTable binding="#{table}" value="#{courses}" var="course"
                         rowStyleClass="#{attendanceBean.getRowClass(table.rowIndex, context)}" >
                <p:column>
                    <f:facet name="header">Course Name</f:facet>
                    <h:outputText id="id" value="#{course.courseName}"/>
                </p:column>
                <p:column>
                    <f:facet name="header">Description</f:facet>
                    <h:outputText value="#{course.description}"/>
                </p:column>
                <p:column>
                    <f:facet name="header">Start Date</f:facet>
                    <h:outputText converter="groupkmp.DateConverter" value="#{course.startDate}"/>
                </p:column>
                <p:column>
                    <f:facet name="header">End Date</f:facet>
                    <h:outputText converter="groupkmp.DateConverter" value="#{course.endDate}"/>
                </p:column>
                <p:column>
                    <f:facet name="header">Take up</f:facet>
                    <h:outputText value="#{course.studentCount}/#{course.maxStudents}"/>
                </p:column>
                <p:column>
                    <f:facet name="header">ID</f:facet>
                    <h:outputText value="#{course.id}"/>
                </p:column>
                <p:column rendered="#{context == 'adminAllCourses'}">
                        <h:commandButton value="Remove" action="#{courseBean.removeCourse(course.id)}"/>
                </p:column>
                <p:column rendered="#{context == 'adminAllCourses'}">
                        <h:commandButton value="Edit" action="#{courseBean.editCourse(course.id)}"/>
                </p:column>
                <p:column rendered="#{context == 'attendance'}">
                    <f:facet name="header">Days</f:facet>
                    <h:outputText value="#{course.days.size()}" />
                </p:column>
                <p:column rendered="#{context == 'attendance'}">
                    <!--h:commandLink value="Take Attendance" action="#{attendanceBean.takeAttendance(course.id)}"-->
                    <h:commandLink value="Take Attendance">
                        <!--f:ajax listener="#{attendanceBean.takeAttendance(course.id)}" render="attendance-form course-form" /-->
                        <f:ajax listener="#{attendanceBean.takeAttendance(course.id)}" />
                        <f:ajax render="attendance-form" />
                        <!--f:ajax execute="courses-table" render="courses-table" /-->
                        <f:ajax render="@form" />
                    </h:commandLink>
                </p:column>
                <p:column rendered="#{context == 'studentOtherCourses'}">
                    <h:commandLink value="Register" action="#{userBean.register(course.id)}"/>
                </p:column>

                <c:set var="hide" value="#{(context == 'studentOtherCourses') and (not course.isFull())}" />
                <!--p:column rendered="${(context == 'studentOtherCourses') and (!course.isFull)}"-->
                <!--p:column rendered="false">
                    <c:if test="${course.isFull()}">
                        <h:commandLink value="Register" action="#{userBean.register(course.id)}"/>
                    </c:if>
                    <c:if test="#{!course.isFull()}">
                        <h:commandLink value="Bloob" action="#{userBean.register(course.id)}"/>
                    </c:if>
                </p:column-->
                <p:column rendered="#{(userBean.isStudent()) and (context == 'studentRegisteredCourses')}">
                    <h:commandLink value="Deregister" action="#{userBean.deregister(course.id)}"/>
                </p:column>
            </p:dataTable>
        </p:panelGrid>
    </h:form>
</f:view>
</html>
