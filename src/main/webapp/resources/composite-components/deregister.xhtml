<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:cc="http://java.sun.com/jsf/composite">
<cc:interface componentType="groupkmp.components.QuestionView">
    <cc:attribute name="courseId" type="java.lang.Long" required="true"/>
    <cc:attribute name="userId" type="java.lang.Long" required="true"/>
    <cc:attribute name="action"
                  method-signature="java.lang.Object action(java.lang.Long, java.lang.Long)"
                  required="true" />

    <!--cc:clientBehavior name="click" targets="questionContainer:questionOptions:qop" event="click"/-->
</cc:interface>

<cc:implementation>
    <f:view>
        <h:form>
<!--
            <h:outputText value="#{cc.attrs.courseId} #{cc.attrs.courseId}" />
-->
<!--
            <h:outputText value="${cc.test(cc.attrs.courseId)}" />
-->
<!--
            <h:outputText value="Started" rendered="${cc.test(cc.attrs.courseId)}" />
-->
            <c:set var="hasStarted" value="#{courseBean.getHasCourseStarted(cc.attrs.courseId)}" />
            <c:set var="isCurrent" value="#{courseBean.getIsCourseCurrent(cc.attrs.courseId)}" />
            <c:set var="hasEnded" value="#{courseBean.getHasCourseEnded(cc.attrs.courseId)}" />
            <c:set var="isRegistered"
                   value="#{courseBean.isStudentRegistered(cc.attrs.courseId, cc.attrs.userId)}" />
            <c:set var="leavingDate"
                   value="#{courseBean.getLeavingDate(cc.attrs.courseId, cc.attrs.userId)}" />
            <c:set var="hasLeavingDate"
                   value="#{leavingDate != null}" />
            <c:set var="hasLeft"
                   value="#{hasLeavingDate and courseBean.getCourseEndDate(cc.attrs.courseId) > leavingDate}" />
            <h:commandLink value="Register"
                           action="#{cc.register(cc.courseId, cc.userId)}"
                           rendered="#{!isRegistered and !hasStarted}" />
            <h:commandLink value="Register"
                           action="#{cc.regHandle}"
                           rendered="#{!isRegistered and !hasStarted}" />
            <h:outputText value="Course Started"
                           rendered="#{!isRegistered and isCurrent}" />
            <h:outputText value="Course Started"
                          rendered="#{!isRegistered and hasEnded}" />
            <h:commandLink value="Deregister h"
                           action="#{cc.deregister(cc.attrs.courseId, cc.attrs.userId)}"
                           rendered="#{isRegistered and !hasStarted}" />
            <h:outputText value="Leave"
                          rendered="#{isRegistered and isCurrent and !hasLeavingDate}" />
            <h:outputText value="Left on #{leavingDate}"
                          rendered="#{isRegistered and isCurrent and hasLeavingDate and hasLeft}" />
            <h:outputText value="Leaving on #{leavingDate}"
                          rendered="#{isRegistered and isCurrent and hasLeavingDate and !hasLeft}" />
            <h:outputText value="Completed"
                          rendered="#{isRegistered and hasEnded}" />

        </h:form>
    </f:view>
</cc:implementation>
</html>
